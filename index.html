<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥n Qu√† B·∫•t Ng·ªù ‚ù§Ô∏è</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <script src="config.js"></script>
    <style>
        /* === GLOBAL STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #d6336c;
            --secondary-color: #fde2e4;
            --text-color: #595959;
            --white: #ffffff;
            --book-shadow: rgba(0, 0, 0, 0.15);
            --transition-duration: 1.2s;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        .scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease-in-out, visibility 0.8s ease-in-out;
            pointer-events: none;
        }

        .scene.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* === SCENE 1: ELEGANT WELCOME === */
        #scene1 {
            background: linear-gradient(135deg, #fde2e4 0%, #fff0f3 50%, #f8d7da 100%);
            position: relative;
        }

        .petals {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .petal {
            position: absolute;
            font-size: 20px;
            opacity: 0.7;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(360deg) translateX(50px);
                opacity: 0;
            }
        }

        .welcome-container {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 20px;
        }

        .welcome-container h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5em;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .welcome-container p {
            font-family: 'Playfair Display', serif;
            font-size: 1.2em;
            color: var(--text-color);
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .elegant-button {
            font-family: 'Quicksand', sans-serif;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(214, 51, 108, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 5px 20px rgba(214, 51, 108, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 8px 25px rgba(214, 51, 108, 0.6);
            }
        }

        .elegant-button:hover {
            background: #b8295a;
            transform: translateY(-2px);
        }

        /* === SCENE 2: LOVE GATE === */
        #scene2 {
            background: linear-gradient(135deg, #fde2e4 0%, #fff0f3 50%, #f8d7da 100%);
            position: relative;
        }

        #scene2::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
        }

        .love-gate-container {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            max-width: 500px;
            margin: 20px;
            z-index: 10;
            position: relative;
        }

        .love-gate-container h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8em;
            color: var(--primary-color);
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .love-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }

        .love-button {
            font-family: 'Quicksand', sans-serif;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .love-button.yes {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 5px 15px rgba(214, 51, 108, 0.3);
        }

        .love-button.yes:hover {
            background: #b8295a;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(214, 51, 108, 0.5);
        }

        .love-button.no {
            background: #f0f0f0;
            color: var(--text-color);
            position: relative;
            transition: all 0.3s ease;
        }

        .error-message {
            color: var(--primary-color);
            font-style: italic;
            margin-top: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .error-message.show {
            opacity: 1;
        }

        /* === SCENE 3: UGLY PRANK === */
        #scene3 {
            background: linear-gradient(45deg, #ff0080, #00ff80, #8000ff, #ff8000);
            background-size: 400% 400%;
            animation: uglyGradient 3s ease infinite;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            overflow-y: auto;
            align-items: flex-start;
            padding: 20px 0;
        }

        @keyframes uglyGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .ugly-container {
            width: 100%;
            max-width: 800px;
            text-align: center;
            padding: 20px;
        }

        .marquee-text {
            background: yellow;
            color: red;
            padding: 10px;
            font-size: 2em;
            font-weight: bold;
            border: 5px solid blue;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px black;
        }

        marquee {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .ugly-title {
            font-size: 3em;
            color: lime;
            text-shadow: 3px 3px 0px purple, 6px 6px 0px orange;
            transform: rotate(-5deg);
            margin: 20px 0;
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(-5deg) translateX(0px); }
            25% { transform: rotate(-3deg) translateX(-2px); }
            75% { transform: rotate(-7deg) translateX(2px); }
        }

        .ugly-content {
            background: rgba(255, 255, 0, 0.8);
            border: 10px dotted red;
            padding: 30px;
            margin: 20px 0;
            font-size: 1.5em;
            color: blue;
            text-shadow: 1px 1px 0px white;
            transform: skew(-2deg);
        }

        .gift-box {
            width: 150px;
            height: 150px;
            background: #ff6b6b;
            border: 5px solid #000;
            margin: 30px auto;
            cursor: pointer;
            position: relative;
            animation: bounce 1s infinite;
            image-rendering: pixelated;
            transition: all 0.3s ease;
        }

        .gift-box::before {
            content: 'üéÅ';
            font-size: 4em;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            filter: pixelated;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .gift-box:hover {
            transform: scale(1.1);
            background: #ff5252;
        }

        .gift-tooltip {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: black;
            color: yellow;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 100;
        }

        .gift-box:hover .gift-tooltip {
            opacity: 1;
        }

        .dancing-gif {
            position: absolute;
            width: 100px;
            height: 100px;
            background: url('data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQACgABACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkEAAoAAgAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkEAAoAAwAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkEAAoABAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQACgAFACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQACgAGACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAAKAAcALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==') no-repeat center;
            background-size: contain;
            animation: rotate 2s linear infinite;
        }

        .dancing-gif:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .dancing-gif:nth-child(2) { top: 20%; right: 15%; animation-delay: 0.5s; }
        .dancing-gif:nth-child(3) { bottom: 30%; left: 20%; animation-delay: 1s; }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* === SCENE 4: STUNNING REVEAL WITH ENHANCED BOOK === */
        #scene4 {
            background: linear-gradient(135deg, #fde2e4 0%, #fff0f3 100%);
            position: relative;
            overflow-y: auto;
            align-items: flex-start;
            padding: 20px 0;
        }

        .shatter-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .shard {
            position: absolute;
            background: linear-gradient(45deg, #ff0080, #00ff80, #8000ff, #ff8000);
            opacity: 0;
        }

        .book-reveal-container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            opacity: 0;
            transform: translateY(50px);
            transition: all 1s ease;
        }

        .book-reveal-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .reveal-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .reveal-title h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5em;
            color: var(--primary-color);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .reveal-title p {
            font-family: 'Playfair Display', serif;
            font-size: 1.2em;
            color: var(--text-color);
            font-style: italic;
        }

        /* Enhanced Book styles */
        .book-container {
            width: 90vw;
            height: 75vh;
            max-width: 900px;
            max-height: 550px;
            position: relative;
            perspective: 2500px;
            margin: 0 auto;
        }

        .book {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(10deg) rotateY(0deg) rotateZ(-1deg);
            transition: transform 0.5s;
        }

        .book:hover {
            transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
        }

        /* Enhanced book spine effect */
        .book::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            width: 10px;
            height: 100%;
            background: linear-gradient(to right, 
                rgba(0,0,0,0.3) 0%,
                rgba(0,0,0,0.2) 20%,
                rgba(0,0,0,0.1) 40%,
                rgba(0,0,0,0.05) 60%,
                transparent 100%);
            transform: translateX(-50%);
            z-index: 1000;
        }

        .page {
            width: 50%;
            height: 100%;
            position: absolute;
            top: 0;
            right: 0;
            transform-origin: left center;
            transform-style: preserve-3d;
            transition: transform var(--transition-duration) cubic-bezier(0.645, 0.045, 0.355, 1),
                        box-shadow var(--transition-duration) ease;
            cursor: pointer;
        }

        /* Enhanced depth and shadow during flip */
        .page.flipping {
            box-shadow: 5px 5px 20px rgba(0, 0, 0, 0.3);
        }

        .page.flipped {
            transform: rotateY(-180deg);
        }

        .page-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background: #fff9fa;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.05);
        }

        .page-face.front {
            border-radius: 0 10px 10px 0;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }

        .page-face.back {
            transform: rotateY(180deg);
            border-radius: 10px 0 0 10px;
        }

        /* Enhanced paper texture */
        .page-face {
            background: 
                #fff9fa 
                url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAQElEQVQoU2NkIAIwEqGGAa8i/v9///7+/Qvhg2S5uLgYGf///w9Sg1cRyEQYn4uLC6ciZCdQzShQx6hCsoJBAACcHhMJAMHj+wAAAABJRU5ErkJggg==') 
                repeat;
            background-size: 100px 100px;
        }

        .page-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 25px;
            box-sizing: border-box;
            position: relative;
            animation: contentFadeIn 0.8s ease forwards;
            opacity: 0;
            overflow: hidden;
        }

        @keyframes contentFadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .static-left-page {
            width: 50%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background: #fff9fa;
            box-shadow: -5px 10px 30px rgba(0, 0, 0, 0.15);
            border-radius: 10px 0 0 10px;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .static-left-page::after {
            content: '';
            position: absolute;
            top: 0;
            right: -10px;
            width: 20px;
            height: 100%;
            background: linear-gradient(to right, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.01));
            z-index: 1000;
        }

        /* Paper edge shadow for realism */
        .page-face.front::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, 
                rgba(0, 0, 0, 0.05) 0%,
                transparent 10%);
            pointer-events: none;
        }

        .cover-content h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5em;
            color: var(--primary-color);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }

        .cover-content p {
            font-style: italic;
            color: var(--text-color);
        }

        .polaroid {
            padding: 10px 10px 20px 10px;
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin: 0 auto 20px auto;
            width: 60%;
            max-width: 200px;
            transition: transform 0.3s ease;
            position: relative;
            z-index: 1;
            display: block;
        }
        
        .polaroid:hover {
            transform: scale(1.05) rotate(0deg) !important;
            z-index: 2;
        }

        .polaroid img {
            width: 100%;
            display: block;
        }

        .polaroid-caption {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5em;
            margin-top: 10px;
        }

        .sticker {
            position: absolute;
            font-size: 2em;
            opacity: 0.8;
            z-index: 1;
        }

        .sticker.heart-pulse {
            top: 10px;
            right: 10px;
            animation: pulse 1.5s infinite;
        }

        .sticker.sparkle {
            bottom: 10px;
            left: 10px;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.3);
                opacity: 1;
            }
        }

        .navigation {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .navigation button {
            font-family: 'Quicksand', sans-serif;
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .navigation button:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .navigation button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Enhanced loading state for navigation buttons */
        .navigation button.nav-loading {
            color: var(--primary-color);
            background: rgba(255, 255, 255, 0.9);
        }

        .navigation button.nav-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            border-top-color: transparent;
            animation: buttonLoading 0.8s linear infinite;
        }

        @keyframes buttonLoading {
            to {
                transform: translateY(-50%) rotate(360deg);
            }
        }

        /* Loading pulse effect */
        .navigation button.nav-loading span {
            animation: loadingPulse 1.5s ease-in-out infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .finale-button {
            background: linear-gradient(135deg, #ff6b6b, #d6336c) !important;
            color: white !important;
            font-weight: 600;
            animation: finalePulse 2s infinite;
            border: none !important;
        }

        @keyframes finalePulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 5px 25px rgba(214, 51, 108, 0.5);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 8px 35px rgba(214, 51, 108, 0.7);
            }
        }

        /* === SCENE 5: GRAND FINALE === */
        #scene5 {
            background: linear-gradient(180deg, #0a0a2e 0%, #16213e 50%, #1a1a3e 100%);
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Memory slideshow background */
        .memory-slideshow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.15;
            overflow: hidden;
        }

        .memory-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 3s ease-in-out;
            filter: blur(2px) brightness(0.7);
        }

        .memory-slide.active {
            opacity: 1;
        }

        #fireworks-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .hearts-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        .floating-heart {
            position: absolute;
            font-size: 30px;
            animation: floatUp linear infinite;
            opacity: 0;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .finale-content {
            position: relative;
            z-index: 10;
            text-align: center;
            color: white;
            padding: 40px;
            opacity: 0;
            animation: finaleContentReveal 2s ease-out forwards;
            animation-delay: 0.5s;
        }

        @keyframes finaleContentReveal {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(30px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .finale-main-heading {
            font-family: 'Dancing Script', cursive;
            font-size: 4em;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 0 60px rgba(255, 215, 0, 0.3);
            margin-bottom: 30px;
        }

        .finale-names {
            font-family: 'Dancing Script', cursive;
            font-size: 5em;
            background: linear-gradient(90deg, #ff6b6b 0%, #feca57 25%, #ff9ff3 50%, #54a0ff 75%, #ff6b6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 100%;
            margin: 20px 0;
            animation: shimmer 3s linear infinite;
            position: relative;
        }

        .finale-names::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(90deg, #ff6b6b 0%, #feca57 25%, #ff9ff3 50%, #54a0ff 75%, #ff6b6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: blur(10px);
            opacity: 0.5;
        }

        @keyframes shimmer {
            0% {
                background-position: 0% 50%;
            }
            100% {
                background-position: 100% 50%;
            }
        }

        /* Love Counter Styles */
        .love-counter {
            margin: 40px 0;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .love-counter-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5em;
            color: #ffd700;
            margin-bottom: 25px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .counter-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .time-unit {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .time-unit:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.2);
        }

        .time-number {
            font-family: 'Quicksand', sans-serif;
            font-size: 2.5em;
            font-weight: 600;
            color: #ff69b4;
            text-shadow: 0 0 15px rgba(255, 105, 180, 0.5);
            margin-bottom: 8px;
            animation: numberPulse 2s ease-in-out infinite;
        }

        .time-label {
            font-family: 'Playfair Display', serif;
            font-size: 1.1em;
            color: #ffd4e5;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 400;
        }

        @keyframes numberPulse {
            0%, 100% {
                transform: scale(1);
                text-shadow: 0 0 15px rgba(255, 105, 180, 0.5);
            }
            50% {
                transform: scale(1.05);
                text-shadow: 0 0 25px rgba(255, 105, 180, 0.8);
            }
        }

        .counter-description {
            font-family: 'Playfair Display', serif;
            font-size: 1.2em;
            color: #ffd4e5;
            font-style: italic;
            margin-top: 20px;
            opacity: 0.9;
        }

        .finale-message {
            font-family: 'Playfair Display', serif;
            font-size: 1.5em;
            font-style: italic;
            color: #ffd4e5;
            margin-top: 30px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* === MEMORY PHOTO SLIDESHOW STYLES === */
        .memory-photos-container {
            margin: 40px 0;
            padding: 30px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .memory-photos-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2.2em;
            color: #ffd700;
            text-align: center;
            margin-bottom: 25px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        .memory-slideshow-main {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .slideshow-wrapper {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: rgba(0, 0, 0, 0.2);
        }

        .photo-container {
            position: relative;
            width: 100%;
            height: 350px;
            overflow: hidden;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .memory-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: scale(1.1);
            filter: sepia(10%) contrast(1.1) brightness(1.05) saturate(1.1);
        }

        .memory-photo.loaded {
            opacity: 1;
            transform: scale(1);
        }

        .memory-photo.fade-out {
            opacity: 0;
            transform: scale(0.95);
        }

        .photo-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.1) 0%,
                transparent 30%,
                transparent 70%,
                rgba(0, 0, 0, 0.4) 100%
            );
            pointer-events: none;
        }

        .photo-caption {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            color: white;
            font-family: 'Dancing Script', cursive;
            font-size: 1.5em;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .photo-caption.show {
            opacity: 1;
            transform: translateY(0);
        }

        .slideshow-controls {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 15px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .slideshow-wrapper:hover .slideshow-controls {
            opacity: 1;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn span {
            font-size: 18px;
            line-height: 1;
        }

        .photo-counter {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-family: 'Quicksand', sans-serif;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Loading state for photos */
        .photo-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            color: #ffd700;
            font-size: 1.2em;
            z-index: 5;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: #ffd700;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Error state */
        .photo-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            color: #ffb3b3;
            font-size: 1.1em;
            text-align: center;
            z-index: 5;
        }

        .photo-error::before {
            content: 'üì∑';
            font-size: 3em;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        /* Empty state when no photos found */
        .no-photos-message {
            text-align: center;
            color: #ffd4e5;
            font-style: italic;
            font-size: 1.1em;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }

        .no-photos-message::before {
            content: 'üíù';
            display: block;
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        /* Star background for Scene 5 */
        #scene5::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 40% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent),
                radial-gradient(1px 1px at 30% 80%, white, transparent),
                radial-gradient(1px 1px at 70% 40%, white, transparent);
            background-size: 200% 200%;
            animation: twinkleStars 5s ease-in-out infinite;
            z-index: 0;
        }
        
        /* Magical cursor trail */
        .cursor-particle {
            position: fixed;
            pointer-events: none;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #ffd700 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0;
            z-index: 9999;
            animation: cursorFade 1s linear forwards;
        }
        
        @keyframes cursorFade {
            0% {
                transform: scale(1) translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: scale(0.5) translate(var(--offsetX, 0), calc(var(--offsetY, -20px) - 20px));
                opacity: 0;
            }
        }

        @keyframes twinkleStars {
            0%, 100% {
                opacity: 0.8;
                transform: scale(1);
            }
            50% {
                opacity: 0.3;
                transform: scale(1.1);
            }
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 768px) {
            .welcome-container h1,
            .reveal-title h1 {
                font-size: 2.5em;
            }

            .welcome-container p,
            .reveal-title p {
                font-size: 1em;
            }

            .love-gate-container h2 {
                font-size: 1.4em;
            }

            .ugly-title {
                font-size: 2em;
            }

            .ugly-content {
                font-size: 1.2em;
                padding: 20px;
            }

            .book-container {
                height: 60vh;
                max-height: 400px;
            }

            .cover-content h1 {
                font-size: 2.5em;
            }
            
            .polaroid {
                width: 50%;
                max-width: 150px;
            }

            .polaroid-caption {
                font-size: 1em;
            }
            
            .page-content {
                padding: 15px;
            }

            .navigation {
                flex-direction: column;
                align-items: center;
            }

            .navigation button {
                width: 200px;
            }
            
            .finale-main-heading {
                font-size: 3em !important;
            }
            
            .finale-names {
                font-size: 3.5em !important;
            }
            
            /* Scene 5 mobile improvements */
            .finale-content {
                padding: 20px 15px;
            }
            
            .counter-display {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 15px;
            }
            
            .time-unit {
                padding: 10px;
            }
            
            .time-number {
                font-size: 2em;
            }
            
            .time-label {
                font-size: 1em;
            }
            
            .photo-container {
                height: 280px;
            }
            
            .memory-photos-container {
                margin: 30px 0;
                padding: 20px 15px;
            }
            
            .memory-photos-title {
                font-size: 2em;
            }
            
            .love-counter {
                margin: 30px 0;
                padding: 20px 15px;
            }
            
            .love-counter-title {
                font-size: 2.2em;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            .welcome-container,
            .love-gate-container {
                padding: 30px 20px;
                margin: 10px;
            }

            .welcome-container h1,
            .reveal-title h1 {
                font-size: 2em;
            }

            .marquee-text {
                font-size: 1.5em;
            }

            .ugly-title {
                font-size: 1.8em;
            }

            .gift-box {
                width: 120px;
                height: 120px;
            }

            .gift-box::before {
                font-size: 3em;
            }

            .book-container {
                height: 50vh;
                max-height: 350px;
            }
        }
    </style>
</head>
<body>
    <!-- Scene 1: Elegant Welcome -->
    <div id="scene1" class="scene active">
        <div class="petals" id="petals-container"></div>
        <div class="welcome-container">
            <h1 id="scene1-title">G·ª≠i ng∆∞·ªùi th∆∞∆°ng c·ªßa t·ªõ...</h1>
            <p id="scene1-description">T·ªõ c√≥ l√†m m·ªôt ƒëi·ªÅu b·∫•t ng·ªù nho nh·ªè, ƒë·ªÉ cho c·∫≠u th·∫•y c·∫≠u quan tr·ªçng v·ªõi t·ªõ nh∆∞·ªùng n√†o.</p>
            <button class="elegant-button" onclick="goToScene(2)" id="scene1-button">M·ªü qu√† n√®!</button>
        </div>
    </div>

    <!-- Scene 2: Love Gate Question -->
    <div id="scene2" class="scene">
        <div class="love-gate-container">
            <h2>Nh∆∞ng tr∆∞·ªõc ti√™n, tr·∫£ l·ªùi c√¢u h·ªèi si√™u quan tr·ªçng n√†y ƒë√£...<br><br>Em c√≥ y√™u anh kh√¥ng?</h2>
            <div class="love-buttons">
                <button class="love-button yes" onclick="goToScene(3)">Y√™u ∆°i l√† y√™u!</button>
                <button class="love-button no" id="no-button" onclick="handleNoClick()">H√¥ng...</button>
            </div>
            <div class="error-message" id="error-message">Sai r·ªìi nha. Ch·ªçn l·∫°i ƒëi! ‚ù§Ô∏è</div>
        </div>
    </div>

    <!-- Scene 3: Ugly Prank Page -->
    <div id="scene3" class="scene">
        <div class="dancing-gif"></div>
        <div class="dancing-gif"></div>
        <div class="dancing-gif"></div>
        
        <div class="ugly-container">
            <div class="marquee-text">
                <marquee behavior="scroll" direction="left">‚ù§Ô∏è EM IU NG·ªêC L√Ä S·ªê 1!!! ‚ù§Ô∏è</marquee>
            </div>
            
            <h1 class="ugly-title">Ch√†o m·ª´ng ƒë·∫øn v·ªõi website t√¨nh iu c·ªßa ch√∫ng ta</h1>
            
            <div class="ugly-content">
                <p>Hoa h·ªìng m√†u ƒë·ªè,<br>
                violet m√†u xanh,<br>
                code anh h∆°i ph√®n,<br>
                nh∆∞ng t√¨nh iu anh l√† th·∫≠t.</p>
            </div>
            
            <div class="gift-box" onclick="revealTruth()">
                <div class="gift-tooltip">B·∫•m v√†o ƒë√¢y ƒë·ªÉ nh·∫≠n qu√† th·∫≠t n√®...</div>
            </div>
        </div>
    </div>

    <!-- Scene 4: Stunning Reveal -->
    <div id="scene4" class="scene">
        <div class="shatter-overlay" id="shatter-overlay"></div>
        
        <div class="book-reveal-container" id="book-container">
            <div class="reveal-title">
                <h1>Cu·ªën s·ªï t√¨nh i√™uu</h1>
                <p>ƒê∆∞·ª£c t·∫°o n√™n b·∫±ng t·∫•t c·∫£ t√¨nh y√™u c·ªßa t·ªõ</p>
            </div>
            
            <div class="book-container">
                <div class="book" id="book">
                    <div class="static-left-page">
                        <div id="left-page-content"></div>
                    </div>
                </div>
            </div>
            
            <div class="navigation">
                <button id="prev-btn" onclick="prevPage()"><span>Trang Tr∆∞·ªõc</span></button>
                <button id="next-btn" onclick="nextPage()"><span>Trang Ti·∫øp</span></button>
                <button id="finale-btn" class="finale-button" onclick="goToScene(5)" style="display: none;"><span>ƒêi ƒë·∫øn y√™u th∆∞∆°ng</span></button>
            </div>
        </div>
    </div>

    <!-- Scene 5: Personalized Grand Finale -->
    <div id="scene5" class="scene">
        <!-- Memory slideshow background -->
        <div class="memory-slideshow" id="memory-slideshow">
            <div class="memory-slide active" style="background-image: url('https://placehold.co/1920x1080/fde2e4/d6336c?text=K·ª∑+Ni·ªám+1')"></div>
            <div class="memory-slide" style="background-image: url('https://placehold.co/1920x1080/e2fde4/33d66c?text=K·ª∑+Ni·ªám+2')"></div>
            <div class="memory-slide" style="background-image: url('https://placehold.co/1920x1080/e2e4fd/336cd6?text=K·ª∑+Ni·ªám+3')"></div>
            <div class="memory-slide" style="background-image: url('https://placehold.co/1920x1080/fde2f4/d633a6?text=K·ª∑+Ni·ªám+4')"></div>
        </div>
        
        <canvas id="fireworks-canvas"></canvas>
        <div class="hearts-container" id="hearts-container"></div>
        
        <div class="finale-content">
            <h1 class="finale-main-heading">Nh·∫≠t K√Ω T√¨nh Y√™u</h1>
            <div class="finale-names" data-text="Kh√°nh ‚ù§Ô∏è Thu">Kh√°nh ‚ù§Ô∏è Thu</div>
            
            <!-- Love Counter -->
            <div class="love-counter">
                <h2 class="love-counter-title">Ch√∫ng ta ƒë√£ y√™u nhau ƒë∆∞·ª£c...</h2>
                <div class="counter-display" id="love-counter-display">
                    <div class="time-unit">
                        <div class="time-number" id="months">4</div>
                        <div class="time-label">Th√°ng</div>
                    </div>
                    <div class="time-unit">
                        <div class="time-number" id="days">0</div>
                        <div class="time-label">Ng√†y</div>
                    </div>
                    <div class="time-unit">
                        <div class="time-number" id="hours">0</div>
                        <div class="time-label">Gi·ªù</div>
                    </div>
                    <div class="time-unit">
                        <div class="time-number" id="minutes">0</div>
                        <div class="time-label">Ph√∫t</div>
                    </div>
                    <div class="time-unit">
                        <div class="time-number" id="seconds">0</div>
                        <div class="time-label">Gi√¢y</div>
                    </div>
                </div>
                <p class="counter-description">T·ª´ ng√†y 26 th√°ng 4 nƒÉm 2025 - M·ªói kho·∫£nh kh·∫Øc ƒë·ªÅu l√† ƒëi·ªÅu k·ª≥ di·ªáu</p>
            </div>
            
            <!-- Memory Photo Slideshow -->
            <div class="memory-photos-container">
                <h3 class="memory-photos-title">Nh·ªØng kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ üì∏</h3>
                <div class="memory-slideshow-main" id="memory-photos-slideshow">
                    <div class="slideshow-wrapper">
                        <div class="photo-container" id="photo-container">
                            <img id="current-photo" src="" alt="K·ª∑ ni·ªám" class="memory-photo">
                            <div class="photo-caption" id="photo-caption"></div>
                            <div class="photo-overlay"></div>
                        </div>
                        <div class="slideshow-controls">
                            <button class="control-btn" id="play-pause-btn" title="T·∫°m d·ª´ng/Ph√°t">
                                <span class="play-icon">‚è∏Ô∏è</span>
                            </button>
                            <button class="control-btn" id="prev-photo-btn" title="·∫¢nh tr∆∞·ªõc">
                                <span class="prev-icon">‚èÆÔ∏è</span>
                            </button>
                            <button class="control-btn" id="next-photo-btn" title="·∫¢nh ti·∫øp">
                                <span class="next-icon">‚è≠Ô∏è</span>
                            </button>
                        </div>
                        <div class="photo-counter" id="photo-counter">
                            <span id="current-photo-index">1</span> / <span id="total-photos">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <p class="finale-message">H√†nh tr√¨nh c·ªßa ch√∫ng ta ch·ªâ m·ªõi b·∫Øt ƒë·∫ßu th√¥i... Y√™u em m√£i m√£i! üíï</p>
        </div>
    </div>

    <script>
        // Global variables
        let currentScene = 1;
        let currentPage = 0;
        let totalPages = 0;
        let isFlipping = false;
        let isTransitioning = false;

        // Book pages data
        const bookPagesData = [
            {
                type: 'static-cover',
                content: `
                    <div class="page-content cover-content">
                        <h1>Cu·ªën S√°ch T√¨nh Y√™u</h1>
                        <p>D√†nh t·∫∑ng c·∫≠u, m·∫£nh gh√©p ho√†n h·∫£o c·ªßa t·ªõ.</p>
                        <div style="margin-top: 30px; font-size: 2em; opacity: 0.5;">üìñ</div>
                    </div>
                `
            },
            {
                type: 'page-content',
                content: `
                    <div style="text-align: center;">
                        <h2 style="color: var(--primary-color); font-family: 'Dancing Script', cursive; font-size: 2em; margin-bottom: 20px;">L·ªùi m·ªü ƒë·∫ßu</h2>
                        <p style="font-style: italic; line-height: 1.8; font-size: 0.95em; padding: 0 10px;">"C·∫≠u ƒë·∫øn khi·∫øn cu·ªôc s·ªëng c·ªßa t·ªõ tr·ªü l√™n t∆∞∆°i s√°ng, h·∫°nh ph√∫c. T·ª´ng trang s√°ch n√†y l√† t·ª´ng k·ª∑ ni·ªám, t·ª´ng kho·∫£nh kh·∫Øc t·ªõ mu·ªën l∆∞u gi·ªØ m√£i m√£i... iu c·∫≠u"</p>
                        <div style="margin-top: 30px; font-size: 1.5em;">üå∏</div>
                    </div>
                `
            },
            {
                type: 'page-content',
                content: `
                    <div style="width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px;">
                        <div class="polaroid" style="transform: rotate(-5deg);">
                            <img src=".\\img\\critical\\1.jpg" alt="B·ª©c ·∫£nh ƒë·∫ßu ti√™n c·ªßa ƒë√¥i ta">
                            <p class="polaroid-caption">B·ª©c ·∫£nh ƒë·∫ßu ti√™n c·ªßa ƒë√¥i ta</p>
                        </div>
                        <p style="font-size: 0.9em; text-align: center; margin: 0;">T·ªõ v·∫´n nh·ªõ ng√†y h√¥m ƒë√≥, ng√†y ch√∫ng m√¨nh ƒëi c√¥ng vi√™n, 2 ƒë·ª©a ng·ªëc ngh·∫øch ng·ªìi ·ªü g√≥c ƒë√≥, ·∫•m √°p, vui v·∫ª v√† r·∫•t l√† h·∫°nh ph√∫c lu√¥nn</p>
                    </div>
                    <div class="sticker heart-pulse">‚ù§Ô∏è</div>
                `
            },
            {
                type: 'page-content',
                content: `
                    <div style="text-align: center;">
                        <h3 style="color: var(--primary-color); font-family: 'Playfair Display', serif; margin-bottom: 20px; font-size: 1.4em;">Nh·ªØng ƒëi·ªÅu nh·ªè b√©</h3>
                        <ul style="text-align: left; list-style: none; max-width: 280px; margin: 0 auto; line-height: 1.8; font-size: 0.95em;">
                            <li>üíù N·ª• c∆∞·ªùi c·ªßa em iu ng·ªëc ng·∫øch xinh tuy·ªát</li>
                            <li>Nh·ªØng l·∫ßn 2 ƒë·ª©a m√¨nh nh·∫Øn tin, g·∫∑p m·∫∑t th·∫≠t l√† vuiii</li>
                            <li>üåô Nh·ªØng cu·ªôc ƒëi·ªán tho·∫°i khuya, nh·∫π nh√†ng, ru r∆∞∆°ng, ·∫•m √°p  v√¥ c√πng lun</li>
                            <li>üéµ B√†i h√°t hai ch√∫ng ta c√πng nhau ng√¢n nga</li>
                            
                        </ul>
                    </div>
                `
            },
            {
                type: 'page-content',
                content: `
                    <div style="width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px;">
                        <div class="polaroid" style="transform: rotate(4deg);">
                            <img src=".\\img\\critical\\2.jpg" alt="K·ª∑ ni·ªám 2">
                            <p class="polaroid-caption">M·ªôt ng√†y th·∫≠t vui</p>
                        </div>
                        <p style="font-size: 0.9em; text-align: center; margin: 0;">·ªû b√™n c·∫≠u, m·ªçi th·ª© tr·ªü n√™n th·∫≠t ƒë·∫∑c bi·ªát v√† h·∫°nh ph√∫c. Cu·ªôc s·ªëng nh∆∞ nhu·ªôm m√†u h·ªìng cho ƒë√¥i ta.</p>
                    </div>
                    <div class="sticker sparkle">‚ú®</div>
                `
            },
            {
                type: 'page-content',
                content: `
                    <div style="text-align: center;">
                        <h2 style="color: #ff6b6b; font-family: 'Dancing Script', cursive; font-size: 1.8em; margin-bottom: 20px;">L·ªùi h·ª©a c·ªßa anh</h2>
                        <p style="font-size: 1em; line-height: 1.8; font-style: italic; padding: 0 10px;">"T·ªõ h·ª©a s·∫Ω lu√¥n l√† ng∆∞·ªùi b√™n c·∫≠u, c√πng c·∫≠u h·∫°nh ph√∫c, c√πng vui, c√πng bu·ªìn, c√πng c√≥ nhau, c√πng nhau chia s·∫ª, Y√™u c·∫≠uu>
                        <div style="margin-top: 25px; font-size: 1.8em;">ü§ùüíï</div>
                    </div>
                `
            },
            {
                type: 'page-content',
                content: `
                    <div style="width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px;">
                        <div class="polaroid" style="transform: rotate(-2deg);">
                            <img src=".\\img\\critical\\3.jpg" alt="K·ª∑ ni·ªám 3">
                            <p class="polaroid-caption">B·ª©c ·∫£nh anh y√™u th√≠ch</p>
                        </div>
                        <p style="font-size: 0.9em; text-align: center; margin: 0;">T·ªõ ch·ªâ mong c√≥ th·ªÉ gi·ªØ m√£i n·ª• c∆∞·ªùi n√†y, n·ª• c·ªùi th∆° ng√¢y vui v·∫ª c·ªßa ng∆∞·ªùi t·ªõ y√™u.</p>
                    </div>
                `
            },
            {
                type: 'page-content',
                content: `
                    <div style="text-align: center; padding: 20px;">
                        <h2 style="color: var(--primary-color); font-family: 'Dancing Script', cursive; font-size: 2.5em; margin-bottom: 20px;">4 th√°ng y√™u th∆∞∆°ng...</h2>
                        <p style="font-size: 1.2em; margin-bottom: 30px;">...v√† h√†nh tr√¨nh n√†y ch·ªâ m·ªõi b·∫Øt ƒë·∫ßu. C·∫£m ∆°n c·∫≠u ƒë√£ ƒë·∫øn b√™n t·ªõ.</p>
                        <div style="font-size: 3em; animation: pulse 1.5s infinite;">üíï</div>
                    </div>
                `
            }
        ];

        // Initialize the experience when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure scene 1 is visible on load
            const scene1 = document.getElementById('scene1');
            scene1.classList.add('active');
            scene1.style.display = 'flex';
            scene1.style.opacity = '1';
            
            // Initialize components
            createPetals();
            setupNoButtonBehavior();
        });

        // Simplified scene transition
        function goToScene(sceneNumber) {
            // Prevent multiple transitions
            if (isTransitioning) return;
            isTransitioning = true;
            
            const oldScene = document.getElementById(`scene${currentScene}`);
            const newScene = document.getElementById(`scene${sceneNumber}`);
            
            // Fade out old scene
            oldScene.classList.remove('active');
            
            // Wait for fade out
            setTimeout(() => {
                oldScene.style.display = 'none';
                
                // Show new scene
                newScene.style.display = 'flex';
                
                // Force reflow
                newScene.offsetHeight;
                
                // Fade in new scene
                newScene.classList.add('active');
                
                currentScene = sceneNumber;
                isTransitioning = false;
                
                // Scene-specific initialization
                if (sceneNumber === 4) {
                    setTimeout(() => {
                        setupBook();
                        const bookContainer = document.getElementById('book-container');
                        if (bookContainer) {
                            bookContainer.classList.add('show');
                        }
                    }, 300);
                } else if (sceneNumber === 5) {
                    initializeFinale();
                }
            }, 800);
        }

        // Create falling petals
        function createPetals() {
            const container = document.getElementById('petals-container');
            if (!container) return;
            
            const petals = ['üå∏', 'üíÆ', 'üíñ', '‚ú®', 'üå∫'];
            
            for (let i = 0; i < 30; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.textContent = petals[Math.floor(Math.random() * petals.length)];
                petal.style.left = Math.random() * 100 + 'vw';
                petal.style.animationDuration = (Math.random() * 5 + 7) + 's';
                petal.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(petal);
            }
        }

        // Setup "No" button behavior with viewport constraints
        function setupNoButtonBehavior() {
            const noButton = document.getElementById('no-button');
            if (!noButton) return;
            
            let moveCount = 0;
            
            noButton.addEventListener('mouseenter', function() {
                if (moveCount < 5) {
                    // Get button dimensions
                    const buttonWidth = this.offsetWidth;
                    const buttonHeight = this.offsetHeight;
                    
                    // Calculate safe boundaries
                    const maxX = window.innerWidth - buttonWidth - 10; // 10px padding from edge
                    const maxY = window.innerHeight - buttonHeight - 10;
                    const minX = 10; // 10px padding from left
                    const minY = 10; // 10px padding from top
                    
                    // Generate random position within safe boundaries
                    const x = Math.random() * (maxX - minX) + minX;
                    const y = Math.random() * (maxY - minY) + minY;
                    
                    this.style.position = 'fixed';
                    this.style.left = x + 'px';
                    this.style.top = y + 'px';
                    this.style.zIndex = '100';
                    moveCount++;
                }
            });

            // Reset position on window resize
            window.addEventListener('resize', function() {
                noButton.style.position = 'relative';
                noButton.style.left = 'auto';
                noButton.style.top = 'auto';
                moveCount = 0;
            });
        }

        // Handle "No" button click
        function handleNoClick() {
            const errorMessage = document.getElementById('error-message');
            if (!errorMessage) return;
            
            errorMessage.classList.add('show');
            
            setTimeout(() => {
                errorMessage.classList.remove('show');
            }, 2000);
        }

        // Reveal truth with shatter effect
        function revealTruth() {
            createShatterEffect();
            
            setTimeout(() => {
                goToScene(4);
            }, 1500);
        }

        // Create shatter effect
        function createShatterEffect() {
            const overlay = document.getElementById('shatter-overlay');
            if (!overlay) return;
            
            overlay.style.display = 'block';
            overlay.innerHTML = ''; // Clear any existing shards
            
            for (let i = 0; i < 50; i++) {
                const shard = document.createElement('div');
                shard.className = 'shard';
                
                const size = Math.random() * 50 + 20;
                shard.style.width = size + 'px';
                shard.style.height = size + 'px';
                shard.style.left = Math.random() * window.innerWidth + 'px';
                shard.style.top = Math.random() * window.innerHeight + 'px';
                
                overlay.appendChild(shard);
                
                // Animate shard
                setTimeout(() => {
                    shard.style.opacity = '1';
                    shard.style.transform = `translate(${(Math.random() - 0.5) * 800}px, ${Math.random() * 800}px) rotate(${Math.random() * 720}deg)`;
                    shard.style.transition = 'all 1.5s ease-out';
                }, i * 15);
            }
            
            // Clean up overlay after animation
            setTimeout(() => {
                overlay.style.display = 'none';
                overlay.innerHTML = '';
            }, 3000);
        }

        // Enhanced book setup with proper z-index management
        function setupBook() {
            const book = document.getElementById('book');
            const leftPageContent = document.getElementById('left-page-content');
            
            if (!book || !leftPageContent) return;
            
            // Clear existing pages
            book.querySelectorAll('.page').forEach(page => page.remove());
            
            const pageContents = bookPagesData.filter(p => p.type === 'page-content');
            totalPages = Math.ceil(pageContents.length / 2);
            currentPage = 0;
            
            // Create pages with proper z-index from the start
            for (let i = 0; i < totalPages; i++) {
                const page = document.createElement('div');
                page.className = 'page';
                page.id = `p${i + 1}`;
                page.style.zIndex = totalPages - i; // Higher pages have lower z-index
                page.innerHTML = `
                    <div class="page-face front">
                        <div class="page-content"></div>
                    </div>
                    <div class="page-face back">
                        <div class="page-content"></div>
                    </div>
                `;
                book.appendChild(page);
            }
            
            // Set up static left page with cover
            const coverData = bookPagesData.find(p => p.type === 'static-cover');
            if (coverData) {
                leftPageContent.innerHTML = coverData.content;
            }
            
            // Hide finale button initially
            const finaleBtn = document.getElementById('finale-btn');
            if (finaleBtn) {
                finaleBtn.style.display = 'none';
            }
            
            // Fill page contents
            const pages = book.querySelectorAll('.page');
            let contentIndex = 0;
            
            for (let i = 0; i < totalPages; i++) {
                const page = pages[i];
                
                const frontContent = page.querySelector('.front .page-content');
                if (frontContent && pageContents[contentIndex]) {
                    frontContent.innerHTML = pageContents[contentIndex].content;
                }
                contentIndex++;
                
                const backContent = page.querySelector('.back .page-content');
                if (backContent && pageContents[contentIndex]) {
                    backContent.innerHTML = pageContents[contentIndex].content;
                }
                contentIndex++;
            }
            
            // Force enable buttons and update their state
            forceEnableButtons();
            updateNavButtons();
        }

        // Simplified and working nextPage function
        function nextPage() {
            if (currentPage >= totalPages || isFlipping) return;
            
            isFlipping = true;
            updateNavButtons();

            const pageElement = document.getElementById(`p${currentPage + 1}`);
            if (!pageElement) {
                isFlipping = false;
                updateNavButtons();
                return;
            }
            
            // Add visual feedback
            pageElement.classList.add('flipping');
            
            // Start the flip animation
            pageElement.classList.add('flipped');
            
            // Listen for animation end using transitionend
            pageElement.addEventListener('transitionend', function() {
                completePageFlip(pageElement, 'next');
            }, { once: true });
        }

        // Simplified and working prevPage function
        function prevPage() {
            if (currentPage <= 0 || isFlipping) return;
            
            isFlipping = true;
            updateNavButtons();

            const pageElement = document.getElementById(`p${currentPage}`);
            if (!pageElement) {
                isFlipping = false;
                updateNavButtons();
                return;
            }
            
            // Add visual feedback
            pageElement.classList.add('flipping');
            
            // Remove the flip
            pageElement.classList.remove('flipped');
            
            // Listen for animation end
            pageElement.addEventListener('transitionend', function() {
                completePageFlip(pageElement, 'prev');
            }, { once: true });
        }

        // FIXED: The missing completePageFlip function
        function completePageFlip(pageElement, direction) {
            // Remove visual feedback
            pageElement.classList.remove('flipping');

            const leftPageContent = document.getElementById('left-page-content');
            const pageContents = bookPagesData.filter(p => p.type === 'page-content');

            if (direction === 'next') {
                // Update page state
                currentPage++;
                
                // Update left page content
                const contentIndex = (currentPage - 1) * 2 + 1;
                if (pageContents[contentIndex]) {
                    leftPageContent.innerHTML = pageContents[contentIndex].content;
                }
                
                // Show finale button if on last page
                if (currentPage === totalPages) {
                    const finaleBtn = document.getElementById('finale-btn');
                    if (finaleBtn) {
                        finaleBtn.style.display = 'inline-block';
                    }
                }
            } else if (direction === 'prev') {
                // Update page state
                currentPage--;
                
                // Update left page content
                if (currentPage === 0) {
                    // Back to cover
                    leftPageContent.innerHTML = bookPagesData.find(p => p.type === 'static-cover').content;
                } else {
                    const contentIndex = (currentPage - 1) * 2 + 1;
                    if (pageContents[contentIndex]) {
                        leftPageContent.innerHTML = pageContents[contentIndex].content;
                    }
                }
                
                // Hide finale button if not on last page
                if (currentPage < totalPages) {
                    const finaleBtn = document.getElementById('finale-btn');
                    if (finaleBtn) {
                        finaleBtn.style.display = 'none';
                    }
                }
            }
            
            // S·ª¨A L·ªñI T·∫†I ƒê√ÇY:
            // 1. ƒê·∫∑t l·∫°i tr·∫°ng th√°i l·∫≠t trang v·ªÅ false TR∆Ø·ªöC.
            isFlipping = false; 
            
            // 2. SAU ƒê√ì m·ªõi c·∫≠p nh·∫≠t tr·∫°ng th√°i c√°c n√∫t.
            updateNavButtons();
        }

        function updateButtonLoadingState(isLoading) {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (isLoading) {
                if (prevBtn) prevBtn.classList.add('nav-loading');
                if (nextBtn) nextBtn.classList.add('nav-loading');
            } else {
                if (prevBtn) prevBtn.classList.remove('nav-loading');
                if (nextBtn) nextBtn.classList.remove('nav-loading');
            }
        }

        // Force enable all navigation buttons
        function forceEnableButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (prevBtn) {
                prevBtn.disabled = false;
                prevBtn.removeAttribute('disabled');
            }
            if (nextBtn) {
                nextBtn.disabled = false;
                nextBtn.removeAttribute('disabled');
            }
            
            console.log('Buttons force enabled!');
        }

        function updateNavButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            console.log('updateNavButtons called - currentPage:', currentPage, 'totalPages:', totalPages, 'isFlipping:', isFlipping);
            
            // Only disable buttons when flipping - allow free navigation
            if (prevBtn) {
                if (isFlipping) {
                    prevBtn.disabled = true;
                } else {
                    prevBtn.disabled = false;
                    prevBtn.removeAttribute('disabled');
                }
                console.log('prev button disabled:', prevBtn.disabled);
            }
            if (nextBtn) {
                if (isFlipping) {
                    nextBtn.disabled = true;
                } else {
                    nextBtn.disabled = false;
                    nextBtn.removeAttribute('disabled');
                }
                console.log('next button disabled:', nextBtn.disabled);
            }
        }

        // Scene 5: Grand Finale Functions
        function initializeFinale() {
            // Start finale effects immediately
            startFireworks();
            startFloatingHearts();
            addMagicalCursor();
            initializeLoveCounter();
            initializeMemorySlideshow();
            initializeMemoryPhotoSlideshow();
        }

        // Fireworks animation
        function startFireworks() {
            const canvas = document.getElementById('fireworks-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const fireworks = [];
            const particles = [];
            const colors = ['#ffd700', '#ff69b4', '#ff1493', '#ffffff', '#ff6b6b', '#feca57'];
            
            // Firework class
            class Firework {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = canvas.height;
                    this.targetY = Math.random() * (canvas.height * 0.5) + 100;
                    this.speed = Math.random() * 3 + 2;
                    this.color = colors[Math.floor(Math.random() * colors.length)];
                    this.trail = [];
                    this.exploded = false;
                }
                
                update() {
                    if (!this.exploded) {
                        this.trail.push({x: this.x, y: this.y});
                        if (this.trail.length > 10) this.trail.shift();
                        
                        this.y -= this.speed;
                        this.speed *= 0.99;
                        
                        if (this.y <= this.targetY || this.speed < 1) {
                            this.explode();
                        }
                    }
                }
                
                explode() {
                    this.exploded = true;
                    for (let i = 0; i < 30; i++) {
                        particles.push(new Particle(this.x, this.y, this.color));
                    }
                }
                
                draw() {
                    if (!this.exploded) {
                        // Draw trail
                        ctx.beginPath();
                        this.trail.forEach((point, index) => {
                            ctx.globalAlpha = index / this.trail.length;
                            ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);
                        });
                        ctx.fillStyle = this.color;
                        ctx.fill();
                        
                        // Draw firework
                        ctx.globalAlpha = 1;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                        ctx.fillStyle = this.color;
                        ctx.fill();
                    }
                }
            }
            
            // Particle class
            class Particle {
                constructor(x, y, color) {
                    this.x = x;
                    this.y = y;
                    this.vx = (Math.random() - 0.5) * 6;
                    this.vy = (Math.random() - 0.5) * 6;
                    this.gravity = 0.1;
                    this.opacity = 1;
                    this.color = color;
                    this.size = Math.random() * 3 + 1;
                }
                
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += this.gravity;
                    this.opacity -= 0.02;
                }
                
                draw() {
                    ctx.globalAlpha = this.opacity;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    
                    // Add glow effect
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = this.color;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }
            
            // Animation loop
            function animate() {
                ctx.globalAlpha = 0.2;
                ctx.fillStyle = '#0a0a2e';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Launch new fireworks
                if (Math.random() < 0.05) {
                    fireworks.push(new Firework());
                }
                
                // Update and draw fireworks
                for (let i = fireworks.length - 1; i >= 0; i--) {
                    fireworks[i].update();
                    fireworks[i].draw();
                    
                    if (fireworks[i].exploded) {
                        fireworks.splice(i, 1);
                    }
                }
                
                // Update and draw particles
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update();
                    particles[i].draw();
                    
                    if (particles[i].opacity <= 0) {
                        particles.splice(i, 1);
                    }
                }
                
                requestAnimationFrame(animate);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
            
            // Interactive fireworks on click/tap
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Create a firework at click position
                const clickFirework = new Firework();
                clickFirework.x = x;
                clickFirework.targetY = y;
                fireworks.push(clickFirework);
            });
            
            // Touch support
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                const touchFirework = new Firework();
                touchFirework.x = x;
                touchFirework.targetY = y;
                fireworks.push(touchFirework);
            });
        }

        // Optimized floating hearts animation
        function startFloatingHearts() {
            const container = document.getElementById('hearts-container');
            if (!container) return;
            
            const hearts = ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó', 'üíù'];
            let lastHeartTime = 0;
            const heartInterval = 500; // milliseconds between hearts
            
            function createHeart() {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                
                const startX = Math.random() * window.innerWidth;
                heart.style.left = startX + 'px';
                
                const size = Math.random() * 20 + 20;
                heart.style.fontSize = size + 'px';
                
                const duration = Math.random() * 5 + 5;
                heart.style.animationDuration = duration + 's';
                
                const sway = Math.random() * 100 - 50;
                heart.style.setProperty('--sway', sway + 'px');
                
                container.appendChild(heart);
                
                // Remove heart after animation
                setTimeout(() => {
                    heart.remove();
                }, duration * 1000);
            }
            
            // Create initial burst of hearts
            for (let i = 0; i < 10; i++) {
                setTimeout(createHeart, i * 100);
            }
            
            // Use requestAnimationFrame for continuous heart creation
            function animateHearts(currentTime) {
                if (currentTime - lastHeartTime > heartInterval) {
                    createHeart();
                    lastHeartTime = currentTime;
                }
                requestAnimationFrame(animateHearts);
            }
            
            requestAnimationFrame(animateHearts);
        }
        
        // Add magical cursor effect
        function addMagicalCursor() {
            if (!document.getElementById('scene5').classList.contains('active')) return;
            
            let mouseX = 0;
            let mouseY = 0;
            let isMouseMoving = false;
            
            function createParticle(x, y) {
                const particle = document.createElement('div');
                particle.className = 'cursor-particle';
                
                // Random color from a magical palette
                const colors = ['#ffd700', '#ff69b4', '#87ceeb', '#98fb98', '#dda0dd'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.background = `radial-gradient(circle, ${color} 0%, transparent 70%)`;
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                // Random offset for particle movement
                const offsetX = (Math.random() - 0.5) * 20;
                const offsetY = (Math.random() - 0.5) * 20;
                particle.style.setProperty('--offsetX', offsetX + 'px');
                particle.style.setProperty('--offsetY', offsetY + 'px');
                
                document.body.appendChild(particle);
                
                // Remove particle after animation
                setTimeout(() => {
                    particle.remove();
                }, 1000);
            }
            
            function handleMouseMove(e) {
                mouseX = e.clientX;
                mouseY = e.clientY;
                
                if (!isMouseMoving) {
                    isMouseMoving = true;
                    
                    // Create multiple particles for a trail effect
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            if (document.getElementById('scene5').classList.contains('active')) {
                                createParticle(mouseX, mouseY);
                            }
                        }, i * 50);
                    }
                    
                    setTimeout(() => {
                        isMouseMoving = false;
                    }, 100);
                }
            }
            
            // Touch support
            function handleTouchMove(e) {
                const touch = e.touches[0];
                mouseX = touch.clientX;
                mouseY = touch.clientY;
                
                if (!isMouseMoving) {
                    isMouseMoving = true;
                    createParticle(mouseX, mouseY);
                    
                    setTimeout(() => {
                        isMouseMoving = false;
                    }, 100);
                }
            }
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('touchmove', handleTouchMove);
            
            // Cleanup when leaving scene 5
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const scene5 = document.getElementById('scene5');
                        if (!scene5.classList.contains('active')) {
                            document.removeEventListener('mousemove', handleMouseMove);
                            document.removeEventListener('touchmove', handleTouchMove);
                            observer.disconnect();
                        }
                    }
                });
            });
            
            observer.observe(document.getElementById('scene5'), {
                attributes: true,
                attributeFilter: ['class']
            });
        }
        
        // Love Counter Functions
        let loveCounterInterval;
        
        function initializeLoveCounter() {
            // Ng√†y b·∫Øt ƒë·∫ßu th·ª±c t·∫ø: 26/04/2025
            const loveStartDate = new Date('2025-04-26T00:00:00');
            
            function updateLoveCounter() {
                const now = new Date();
                
                // T√≠nh to√°n ch√≠nh x√°c s·ªë th√°ng v√† ng√†y d·ª±a tr√™n l·ªãch th·ª±c t·∫ø
                const result = calculateExactTimeDifference(loveStartDate, now);
                
                // Update the display with animation
                updateCounterElement('months', result.months);
                updateCounterElement('days', result.days);
                updateCounterElement('hours', result.hours);
                updateCounterElement('minutes', result.minutes);
                updateCounterElement('seconds', result.seconds);
            }
            
            // H√†m t√≠nh to√°n ch√≠nh x√°c th·ªùi gian d·ª±a tr√™n l·ªãch th·ª±c t·∫ø
            function calculateExactTimeDifference(startDate, endDate) {
                let start = new Date(startDate);
                let end = new Date(endDate);
                
                // ƒê·∫£m b·∫£o endDate lu√¥n l·ªõn h∆°n startDate
                if (end < start) {
                    [start, end] = [end, start];
                }
                
                // T√≠nh s·ªë th√°ng tr√≤n
                let months = 0;
                let tempDate = new Date(start);
                
                // ƒê·∫øm s·ªë th√°ng tr√≤n c√≥ th·ªÉ c·ªông th√™m
                while (true) {
                    const nextMonth = new Date(tempDate);
                    nextMonth.setMonth(nextMonth.getMonth() + 1);
                    
                    if (nextMonth <= end) {
                        months++;
                        tempDate = nextMonth;
                    } else {
                        break;
                    }
                }
                
                // T√≠nh s·ªë ng√†y c√≤n l·∫°i sau khi ƒë√£ tr·ª´ c√°c th√°ng tr√≤n
                const remainingTime = end - tempDate;
                const days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
                const hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
                
                return {
                    months: months,
                    days: days,
                    hours: hours,
                    minutes: minutes,
                    seconds: seconds
                };
            }
            
            function updateCounterElement(elementId, newValue) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const currentValue = parseInt(element.textContent) || 0;
                
                if (currentValue !== newValue) {
                    // Add animation class for number change
                    element.style.transform = 'scale(1.1)';
                    element.style.color = '#ffd700';
                    
                    setTimeout(() => {
                        element.textContent = newValue;
                        element.style.transform = 'scale(1)';
                        element.style.color = '#ff69b4';
                    }, 150);
                }
            }
            
            // Update immediately
            updateLoveCounter();
            
            // Update every second
            loveCounterInterval = setInterval(updateLoveCounter, 1000);
        }
        
        // Memory Photo Slideshow Functions
        let memoryPhotos = [];
        let currentPhotoIndex = 0;
        let photoSlideshowInterval;
        let isPhotoSlideshowPlaying = true;
        let isPhotoLoading = false;
        
        // Configuration
        const PHOTO_CONFIG = {
            folder: 'img/memories/',
            extensions: ['jpg', 'jpeg', 'png', 'JPG', 'JPEG', 'PNG'],
            autoPlayDelay: 4000, // 4 seconds
            fadeTransitionTime: 1200 // 1.2 seconds
        };
        
        async function initializeMemoryPhotoSlideshow() {
            try {
                showPhotoLoading();
                await loadMemoryPhotos();
                if (memoryPhotos.length > 0) {
                    setupPhotoSlideshow();
                    startPhotoSlideshow();
                } else {
                    showNoPhotosMessage();
                }
            } catch (error) {
                console.error('Error initializing photo slideshow:', error);
                showPhotoError();
            }
        }
        
        async function loadMemoryPhotos() {
            // Since we can't directly access file system from browser,
            // we'll try to load a predefined list of photos based on common naming patterns
            const potentialPhotos = [];
            
            // Generate potential photo names based on the pattern we see in the folder
            const commonPatterns = [
                // IMG_YYYYMMDD_HHMMSS format
                'IMG_20250511_213320',
                'IMG_20250513_223115',
                'IMG_20250513_223125',
                'IMG_20250521_203655',
                'IMG_20250521_203706',
                'IMG_20250521_213344',
                'IMG_20250602_171204',
                'IMG_20250622_135212 (1)',
                'IMG_20250622_135213',
                'IMG_20250622_135215',
                'IMG_20250622_135218 (1)',
                'IMG_20250622_135219',
                'IMG_20250622_135220',
                'IMG_20250622_135222',
                'IMG_20250622_135223',
                'IMG_20250622_135224',
                'IMG_20250622_135225',
                'IMG_20250622_135226',
                'IMG_20250622_135227',
                'IMG_20250622_135228',
                'IMG_20250622_135507',
                'IMG_20250622_135524',
                'IMG_20250622_135706',
                'IMG_20250622_135855',
                'IMG_20250622_140017',
                'IMG_20250622_140431',
                'IMG_20250622_141025',
                'IMG_20250622_185042',
                'IMG_20250622_185045',
                'IMG_20250622_185046',
                'IMG_20250623_174003',
                'IMG_20250706_171540',
                'IMG_20250713_081605',
                'IMG_20250713_081606',
                'IMG_20250713_081743',
                'IMG_20250713_081749',
                'IMG_20250713_081805',
                'IMG_20250713_090121',
                'IMG_20250713_090154',
                'IMG_20250713_092603',
                'IMG_20250713_092605',
                'IMG_20250713_092620',
                'IMG_20250713_092634',
                'IMG_20250713_093858',
                'IMG_20250713_103212',
                'IMG_20250720_113241',
                'IMG_20250722_223817',
                'IMG_20250722_223828'
            ];
            
            // Test each potential photo
            for (const baseName of commonPatterns) {
                for (const ext of PHOTO_CONFIG.extensions) {
                    const photoPath = `${PHOTO_CONFIG.folder}${baseName}.${ext}`;
                    
                    try {
                        const exists = await checkImageExists(photoPath);
                        if (exists) {
                            const caption = generateCaption(baseName);
                            potentialPhotos.push({
                                path: photoPath,
                                caption: caption,
                                filename: `${baseName}.${ext}`
                            });
                            break; // Found this image, don't check other extensions
                        }
                    } catch (error) {
                        // Continue to next photo
                        continue;
                    }
                }
            }
            
            // Shuffle the photos for random display
            memoryPhotos = shuffleArray(potentialPhotos);
            console.log(`Loaded ${memoryPhotos.length} memory photos`);
        }
        
        function checkImageExists(imagePath) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = imagePath;
            });
        }
        
        function generateCaption(filename) {
            // Extract date from filename if it follows IMG_YYYYMMDD_HHMMSS pattern
            const dateMatch = filename.match(/IMG_(\d{4})(\d{2})(\d{2})_(\d{2})(\d{2})(\d{2})/);
            
            if (dateMatch) {
                const [, year, month, day, hour, minute] = dateMatch;
                const date = new Date(year, month - 1, day, hour, minute);
                
                const options = {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                };
                
                const formattedDate = date.toLocaleDateString('vi-VN', options);
                return `K·ª∑ ni·ªám ng√†y ${formattedDate} üíï`;
            }
            
            // Fallback captions for other patterns
            return 'M·ªôt kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ ‚ú®';
        }
        
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        function setupPhotoSlideshow() {
            if (memoryPhotos.length === 0) return;
            
            const photoContainer = document.getElementById('photo-container');
            const totalPhotosElement = document.getElementById('total-photos');
            const currentPhotoIndexElement = document.getElementById('current-photo-index');
            
            if (totalPhotosElement) {
                totalPhotosElement.textContent = memoryPhotos.length;
            }
            
            // Setup controls
            setupPhotoControls();
            
            // Display first photo
            currentPhotoIndex = 0;
            displayPhoto(currentPhotoIndex);
            
            hidePhotoLoading();
        }
        
        function setupPhotoControls() {
            const playPauseBtn = document.getElementById('play-pause-btn');
            const prevPhotoBtn = document.getElementById('prev-photo-btn');
            const nextPhotoBtn = document.getElementById('next-photo-btn');
            
            if (playPauseBtn) {
                playPauseBtn.addEventListener('click', togglePhotoSlideshow);
            }
            
            if (prevPhotoBtn) {
                prevPhotoBtn.addEventListener('click', showPreviousPhoto);
            }
            
            if (nextPhotoBtn) {
                nextPhotoBtn.addEventListener('click', showNextPhoto);
            }
        }
        
        function displayPhoto(index) {
            if (!memoryPhotos || memoryPhotos.length === 0 || index < 0 || index >= memoryPhotos.length) {
                return;
            }
            
            isPhotoLoading = true;
            const photo = memoryPhotos[index];
            const currentPhotoImg = document.getElementById('current-photo');
            const photoCaptionElement = document.getElementById('photo-caption');
            const currentIndexElement = document.getElementById('current-photo-index');
            
            if (!currentPhotoImg) return;
            
            // Fade out current photo
            currentPhotoImg.classList.add('fade-out');
            
            // Update photo counter
            if (currentIndexElement) {
                currentIndexElement.textContent = index + 1;
            }
            
            // Hide caption
            if (photoCaptionElement) {
                photoCaptionElement.classList.remove('show');
            }
            
            setTimeout(() => {
                // Load new image
                const newImg = new Image();
                newImg.onload = function() {
                    currentPhotoImg.src = photo.path;
                    currentPhotoImg.classList.remove('fade-out');
                    currentPhotoImg.classList.add('loaded');
                    
                    // Show caption after a delay
                    if (photoCaptionElement && photo.caption) {
                        photoCaptionElement.textContent = photo.caption;
                        setTimeout(() => {
                            photoCaptionElement.classList.add('show');
                        }, 500);
                    }
                    
                    isPhotoLoading = false;
                };
                newImg.onerror = function() {
                    console.error('Failed to load photo:', photo.path);
                    // Try next photo
                    showNextPhoto();
                    isPhotoLoading = false;
                };
                newImg.src = photo.path;
            }, PHOTO_CONFIG.fadeTransitionTime / 2);
        }
        
        function startPhotoSlideshow() {
            if (memoryPhotos.length <= 1) return;
            
            photoSlideshowInterval = setInterval(() => {
                if (isPhotoSlideshowPlaying && !isPhotoLoading) {
                    showNextPhoto();
                }
            }, PHOTO_CONFIG.autoPlayDelay);
        }
        
        function stopPhotoSlideshow() {
            if (photoSlideshowInterval) {
                clearInterval(photoSlideshowInterval);
                photoSlideshowInterval = null;
            }
        }
        
        function togglePhotoSlideshow() {
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playIcon = playPauseBtn?.querySelector('.play-icon');
            
            isPhotoSlideshowPlaying = !isPhotoSlideshowPlaying;
            
            if (playIcon) {
                playIcon.textContent = isPhotoSlideshowPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
                playPauseBtn.title = isPhotoSlideshowPlaying ? 'T·∫°m d·ª´ng' : 'Ph√°t';
            }
            
            if (isPhotoSlideshowPlaying) {
                startPhotoSlideshow();
            } else {
                stopPhotoSlideshow();
            }
        }
        
        function showNextPhoto() {
            if (memoryPhotos.length === 0 || isPhotoLoading) return;
            
            currentPhotoIndex = (currentPhotoIndex + 1) % memoryPhotos.length;
            displayPhoto(currentPhotoIndex);
        }
        
        function showPreviousPhoto() {
            if (memoryPhotos.length === 0 || isPhotoLoading) return;
            
            currentPhotoIndex = currentPhotoIndex === 0 ? memoryPhotos.length - 1 : currentPhotoIndex - 1;
            displayPhoto(currentPhotoIndex);
        }
        
        function showPhotoLoading() {
            const photoContainer = document.getElementById('photo-container');
            if (!photoContainer) return;
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'photo-loading';
            loadingDiv.id = 'photo-loading-state';
            loadingDiv.innerHTML = `
                <div class="loading-spinner"></div>
                <span>ƒêang t·∫£i ·∫£nh k·ª∑ ni·ªám...</span>
            `;
            photoContainer.appendChild(loadingDiv);
        }
        
        function hidePhotoLoading() {
            const loadingElement = document.getElementById('photo-loading-state');
            if (loadingElement) {
                loadingElement.remove();
            }
        }
        
        function showPhotoError() {
            const photoContainer = document.getElementById('photo-container');
            if (!photoContainer) return;
            
            hidePhotoLoading();
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'photo-error';
            errorDiv.innerHTML = `
                <span>Kh√¥ng th·ªÉ t·∫£i ·∫£nh k·ª∑ ni·ªám</span>
            `;
            photoContainer.appendChild(errorDiv);
        }
        
        function showNoPhotosMessage() {
            const slideshowMain = document.getElementById('memory-photos-slideshow');
            if (!slideshowMain) return;
            
            hidePhotoLoading();
            
            slideshowMain.innerHTML = `
                <div class="no-photos-message">
                    Ch∆∞a c√≥ ·∫£nh k·ª∑ ni·ªám n√†o trong th∆∞ m·ª•c.<br>
                    H√£y th√™m ·∫£nh v√†o th∆∞ m·ª•c <code>img/memories/</code>
                </div>
            `;
        }
        
        // Background slideshow (existing functionality)
        let slideshowInterval;
        let currentSlideIndex = 0;
        
        function initializeMemorySlideshow() {
            const slides = document.querySelectorAll('.memory-slide');
            if (!slides || slides.length === 0) return;
            
            // Start with the first slide
            slides[0].classList.add('active');
            currentSlideIndex = 0;
            
            function nextSlide() {
                // Remove active class from current slide
                slides[currentSlideIndex].classList.remove('active');
                
                // Move to next slide (loop back to 0 if at the end)
                currentSlideIndex = (currentSlideIndex + 1) % slides.length;
                
                // Add active class to new slide
                slides[currentSlideIndex].classList.add('active');
            }
            
            // Change slide every 5 seconds
            slideshowInterval = setInterval(nextSlide, 5000);
        }
        
        // Cleanup functions when leaving scene 5
        function cleanupScene5() {
            if (loveCounterInterval) {
                clearInterval(loveCounterInterval);
                loveCounterInterval = null;
            }
            
            if (slideshowInterval) {
                clearInterval(slideshowInterval);
                slideshowInterval = null;
            }
        }
        
        // Enhanced scene transition to include cleanup
        const originalGoToScene = goToScene;
        goToScene = function(sceneNumber) {
            // If leaving scene 5, cleanup
            if (currentScene === 5 && sceneNumber !== 5) {
                cleanupScene5();
            }
            
            // Call original function
            originalGoToScene(sceneNumber);
        };
    </script>
</body>
</html>
